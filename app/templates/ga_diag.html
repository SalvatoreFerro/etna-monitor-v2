{% extends "layout.html" %}

{% block content %}
  <section class="container ga-diagnostics" aria-labelledby="ga-diagnostics-title">
    <div class="content">
      <h1 id="ga-diagnostics-title">GA4 Diagnostics</h1>
      <p>Measurement ID attivo: <code>{{ measurement_id or 'missing' }}</code></p>
      <p>ID Google Ads configurato: <code>{{ analytics.google_ads_id or 'non configurato' }}</code></p>
      <p>Usa questa pagina per verificare che gli script GA4 siano caricati correttamente con la CSP attuale.</p>
    </div>
  </section>
{% endblock %}

{% block extra_scripts %}
  {{ super() }}
  <script nonce="{{ script_nonce }}">
    console.log("GA ID:", "{{ measurement_id }}");
    (async () => {
      try {
        await fetch("https://www.google-analytics.com/g/collect", { mode: "no-cors" });
        console.log("GA fetch: OK");
      } catch (error) {
        console.error("GA fetch error", error);
      }
    })();
  </script>
{% endblock %}
