{% set nav_links = [
  {'label': 'Home', 'url': url_for('main.index'), 'endpoint': 'main.index'},
  {'label': 'Progetto', 'url': url_for('main.progetto'), 'endpoint': 'main.progetto'},
  {'label': 'Team', 'url': url_for('main.team'), 'endpoint': 'main.team'},
  {'label': 'Etna 3D', 'url': url_for('main.etna3d'), 'endpoint': 'main.etna3d'},
  {'label': 'Experience', 'url': url_for('experience.experience_home'), 'endpoint': 'experience.experience_home'},
  {'label': 'Prezzi', 'url': url_for('main.pricing'), 'endpoint': 'main.pricing'},
] %}
{% set quick_links = nav_links %}

{% set default_selection = quick_links[:3] %}

<nav class="site-nav" role="navigation" aria-label="Navigazione principale">
  <div class="container site-nav__inner">
    <a class="site-nav__brand" href="/" aria-label="EtnaMonitor home">
      <span class="site-nav__mark">EM</span>
      <span>EtnaMonitor</span>
    </a>

    <button
      class="site-nav__toggle"
      type="button"
      aria-label="Apri il menu di navigazione"
      aria-controls="navbar-menu"
      aria-expanded="false"
      data-site-nav-toggle
    >
      <span class="sr-only">Apri il menu</span>
      <span class="site-nav__toggle-bars" aria-hidden="true"></span>
    </button>

    <div class="site-nav__controls">
      <div
        class="site-nav__selected"
        data-nav-selected
        data-nav-current-endpoint="{{ request.endpoint or '' }}"
      >
        {% for link in default_selection %}
          <a
            class="nav-chip {{ 'is-active' if request.endpoint == link.endpoint }}"
            href="{{ link.url }}"
            data-endpoint="{{ link.endpoint }}"
          >
            {{ link.label }}
          </a>
        {% endfor %}
      </div>

      <div class="nav-multiselect" data-nav-multiselect>
        <button
          type="button"
          class="nav-multiselect__toggle"
          data-nav-toggle
          aria-haspopup="true"
          aria-expanded="false"
          aria-controls="nav-multiselect-menu"
        >
          <span class="nav-multiselect__label">Sezioni rapide</span>
          <span class="nav-multiselect__count" data-nav-count>{{ default_selection|length }}</span>
          <span class="nav-multiselect__icon" aria-hidden="true"></span>
        </button>
        <div class="nav-multiselect__menu" id="nav-multiselect-menu" data-nav-menu hidden>
          <fieldset>
            <legend>Personalizza scorciatoie</legend>
            <ul class="nav-multiselect__list">
              {% for link in quick_links %}
                {% set is_default = link in default_selection %}
                <li>
                  <label>
                    <input
                      type="checkbox"
                      value="{{ link.endpoint }}"
                      data-nav-option
                      data-url="{{ link.url }}"
                      data-label="{{ link.label }}"
                      {% if is_default %}checked data-default="true"{% endif %}
                    />
                    <span>{{ link.label }}</span>
                  </label>
                </li>
              {% endfor %}
            </ul>
          </fieldset>
          <div class="nav-multiselect__actions">
            <button type="button" class="btn btn-primary btn-sm" data-nav-apply>Applica</button>
            <button type="button" class="btn btn-ghost btn-sm" data-nav-reset>Reset</button>
          </div>
        </div>
      </div>
    </div>

    <div class="site-nav__menu" id="navbar-menu" data-site-nav-menu aria-hidden="true">
      <div class="site-nav__menu-inner">
        <ul class="site-nav__quick-links">
          {% for link in nav_links %}
            <li>
              <a class="site-nav__quick-link {{ 'is-active' if request.endpoint == link.endpoint }}" href="{{ link.url }}">
                <span>{{ link.label }}</span>
              </a>
            </li>
          {% endfor %}
        </ul>
      </div>
    </div>

    <div class="site-nav__auth">
      {% if session.user_id %}
        {% set display_name = (current_user.name if current_user else None) or (current_user.email if current_user else None) or 'Utente' %}
        <a class="btn btn-ghost btn-sm" href="{{ url_for('dashboard.dashboard_home') }}">Dashboard</a>
        <a class="btn btn-primary btn-sm" href="{{ url_for('auth.logout') }}">Esci</a>
        <span class="muted" aria-hidden="true">{{ display_name }}</span>
      {% else %}
        <form class="site-nav__auth-form" action="{{ url_for('auth.auth_google') }}" method="post">
          <input type="hidden" name="next" value="{{ request.full_path if request.query_string else request.path }}" />
          <button type="submit" class="btn btn-ghost btn-sm">Accedi</button>
        </form>
        <a class="btn btn-primary btn-sm" href="{{ url_for('main.pricing') }}">Piani</a>
      {% endif %}
    </div>
  </div>
</nav>
