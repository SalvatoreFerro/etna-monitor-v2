{% extends "layout.html" %}

{% block content %}
{% set is_authenticated = current_user and current_user.is_authenticated %}
{% set has_premium = is_authenticated and current_user.has_premium_access %}
{% set has_telegram = is_authenticated and (current_user.telegram_chat_id or current_user.chat_id) %}
{% if not is_authenticated %}
  {% set cta_state = 'guest' %}
  {% set cta_label = 'Attiva EtnaBot' %}
  {% set cta_url = url_for('auth.login') %}
  {% set cta_note = "Accedi o registrati per attivare EtnaBot e ricevere il primo alert gratuito." %}
  {% set cta_alert_text = "Attiva EtnaBot, la prima notifica Telegram Ã¨ GRATIS." %}
  {% set cta_panel_text = "Imposta la tua soglia, ricevi il primo alert gratuito e resta sempre aggiornato." %}
{% elif not has_premium %}
  {% set cta_state = 'free' %}
  {% set cta_label = 'Attiva Premium (PayPal)' %}
  {% set cta_url = url_for('billing.donate') %}
  {% set cta_note = "Premium si attiva con donazione PayPal (min. â‚¬9,99). Nella donazione inserisci la tua email di registrazione." %}
  {% set cta_alert_text = "EtnaBot si attiva con Premium: donazione PayPal (min. â‚¬9,99) + email di registrazione." %}
  {% set cta_panel_text = "Attiva Premium con donazione PayPal (min. â‚¬9,99) e inserisci l'email di registrazione." %}
{% elif not has_telegram %}
  {% set cta_state = 'premium_no_telegram' %}
  {% set cta_label = 'Collega Telegram' %}
  {% set cta_url = url_for('dashboard.dashboard_home') ~ '#alert-settings' %}
  {% set cta_note = "Hai Premium attivo: collega Telegram per iniziare a ricevere gli alert." %}
  {% set cta_alert_text = "Collega Telegram per attivare EtnaBot e ricevere alert istantanei." %}
  {% set cta_panel_text = "Collega Telegram in dashboard per completare l'attivazione di EtnaBot." %}
{% else %}
  {% set cta_state = 'active' %}
  {% set cta_label = 'EtnaBot attivo' %}
  {% set cta_url = none %}
  {% set cta_note = "EtnaBot Ã¨ giÃ  attivo e sincronizzato con Telegram." %}
  {% set cta_alert_text = "EtnaBot Ã¨ attivo: gli alert Telegram sono giÃ  sincronizzati." %}
  {% set cta_panel_text = "EtnaBot Ã¨ attivo e pronto: puoi gestire soglie e notifiche in dashboard." %}
{% endif %}
<section class="page etna-bot-page">
  <div class="container stack">
    <header class="page__header etna-bot-page__hero">
      <span class="eyebrow">Telegram Alerts</span>
      <h1>Il bot Telegram che ti avvisa quando il tremore dellâ€™Etna aumenta</h1>
      <p class="page__lede">Alert automatici, soglia personalizzabile e prima notifica gratis.</p>
      <p class="muted">{{ cta_note }}</p>
      {% if cta_url %}
        <a href="{{ cta_url }}" class="btn btn-primary btn-hero">{{ cta_label }}</a>
      {% else %}
        <button type="button" class="btn btn-primary btn-hero" disabled aria-disabled="true">{{ cta_label }}</button>
      {% endif %}
    </header>

    <section class="bot-feature-grid" aria-label="FunzionalitÃ  EtnaBot">
      <article class="bot-feature-card">
        <h2>Come funziona</h2>
        <ul>
          <li>Monitoraggio 24/7 del tremore INGV con soglie dinamiche.</li>
          <li>Prima notifica gratuita per provare subito lâ€™alert via Telegram.</li>
          <li>Notifiche illimitate con soglia personalizzabile (Premium con donazione PayPal).</li>
          <li>Alert istantanei su Telegram con testo contestuale e link rapidi.</li>
        </ul>
        <div class="bot-feature-card__cta">
          {% if cta_url %}
            <a href="{{ cta_url }}" class="btn btn-primary btn-hero">{{ cta_label }}</a>
          {% else %}
            <button type="button" class="btn btn-primary btn-hero" disabled aria-disabled="true">{{ cta_label }}</button>
          {% endif %}
        </div>
      </article>
      <article class="bot-demo-card" aria-labelledby="bot-demo-title">
        <div class="bot-demo-card__header">
          <span class="pill">Esempio notifica</span>
          <strong id="bot-demo-title">Alert EtnaBot</strong>
        </div>
        <p>ðŸ”” Tremore in aumento sul canale Nord. Ultimo valore: <strong>3.4</strong> (soglia personalizzata 3.0).</p>
        <p class="muted">Aggiornamento istantaneo dal grafico INGV â€“ 10:42 UTC</p>
        <div class="bot-demo-card__footer">
          <span>Rispondi con una nota o apri il grafico live.</span>
        </div>
      </article>
    </section>

    <section class="cta-alert">
      <h3>ðŸ”” Vuoi ricevere un avviso quando il tremore dellâ€™Etna aumenta?</h3>
      <p>{{ cta_alert_text }}</p>
      {% if cta_url %}
        <a href="{{ cta_url }}" class="btn btn-primary btn-hero">{{ cta_label }}</a>
      {% else %}
        <button type="button" class="btn btn-primary btn-hero" disabled aria-disabled="true">{{ cta_label }}</button>
      {% endif %}
    </section>

    <section class="bot-reasons" aria-labelledby="bot-reasons-title">
      <h2 id="bot-reasons-title">PerchÃ© usarlo</h2>
      <ul class="bot-reasons__list">
        <li>Aumento improvviso del tremore</li>
        <li>AttivitÃ  stromboliana</li>
        <li>Fasi pre-eruttive da monitorare minuto per minuto</li>
        <li>Monitoraggio semplice per trekking, operatori turistici e residenti</li>
      </ul>
    </section>

    <section class="plan-summary" aria-label="Riassunto piani EtnaBot">
      <article class="plan-summary__card">
        <h3>Free</h3>
        <p>Prima notifica GRATIS appena colleghi il tuo profilo Telegram.</p>
        <ul>
          <li>Accesso completo al grafico live</li>
          <li>Alert di prova per testare il servizio</li>
          <li>Dashboard responsive e note tecniche</li>
        </ul>
      </article>
      <article class="plan-summary__card plan-summary__card--premium">
        <h3>Premium</h3>
        <p>Notifiche illimitate + soglia personalizzabile + funzionalitÃ  avanzate.</p>
        <ul>
          <li>Alert multi-canale con prioritÃ </li>
          <li>Soglie personalizzate per attivitÃ  specifiche</li>
          <li>Accesso anticipato a feature sperimentali</li>
        </ul>
      </article>
    </section>

    <div class="cta-panel bot-cta-panel">
      <div>
        <h2>Attiva EtnaBot ora</h2>
        <p>{{ cta_panel_text }}</p>
      </div>
      <div class="cta-panel__actions">
        {% if cta_url %}
          <a href="{{ cta_url }}" class="btn btn-primary btn-hero">{{ cta_label }}</a>
        {% else %}
          <button type="button" class="btn btn-primary btn-hero" disabled aria-disabled="true">{{ cta_label }}</button>
        {% endif %}
      </div>
    </div>
  </div>
</section>
{% endblock %}
