{% extends "layout.html" %}

{% block head %}
  {{ super() }}
  <link rel="stylesheet" href="{{ url_for('static', filename='css/admin.css') }}">
{% endblock %}

{% block title %}Gestione Banner Sponsor{% endblock %}

{% block content %}
<section class="admin-page admin-container" aria-labelledby="admin-banners-title">
  <header class="admin-card admin-card--hero card-premium animate-premium-fade admin-header" id="admin-banners-title">
    <div>
      <h1><i class="fas fa-image"></i> Banner sponsorizzati</h1>
      <p>Carica, attiva o disattiva i banner visibili sulle pagine pubbliche.</p>
    </div>
    <nav class="admin-actions" aria-label="Navigazione amministratore">
      <a href="{{ url_for('admin.admin_home') }}" class="btn btn-secondary glass btn-sm"><i class="fas fa-arrow-left"></i> Torna alla dashboard admin</a>
    </nav>
  </header>

  <article class="admin-card card-premium animate-premium-slide admin-highlight-card">
    <form method="POST" action="{{ url_for('admin.banner_create') }}" class="stacked-form">
      <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
      <h2>Nuovo banner</h2>
      <div class="form-grid">
        <div class="form-group">
          <label for="title">Titolo</label>
          <input type="text" id="title" name="title" class="input-base" placeholder="Nome sponsor" required>
        </div>
        <div class="form-group">
          <label for="image_url">URL immagine</label>
          <input type="url" id="image_url" name="image_url" class="input-base" placeholder="https://" required>
        </div>
        <div class="form-group">
          <label for="target_url">Link destinazione</label>
          <input type="url" id="target_url" name="target_url" class="input-base" placeholder="https://" required>
        </div>
      </div>
      <div class="form-group">
        <label for="description">Descrizione (opzionale)</label>
        <textarea id="description" name="description" class="input-base" rows="2" placeholder="Messaggio breve"></textarea>
      </div>
      <label class="checkbox-inline">
        <input type="checkbox" name="active" value="1" checked> Attiva subito
      </label>
      <div>
        <button type="submit" class="btn btn-premium"><i class="fas fa-plus"></i> Crea banner</button>
      </div>
    </form>
  </article>

  <article class="admin-card card-premium animate-premium-fade">
    <h2>Banner esistenti</h2>
    {% if banners %}
      <div class="banner-list">
        {% for banner in banners %}
          <article class="banner-item">
            <div class="banner-preview">
              <img src="{{ banner.image_url }}" alt="{{ banner.title }}" loading="lazy">
            </div>
            <div class="banner-details">
              <form method="POST" action="{{ url_for('admin.banner_update', banner_id=banner.id) }}" class="banner-form">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <div class="form-grid">
                  <div class="form-group">
                    <label for="title-{{ banner.id }}">Titolo</label>
                    <input type="text" id="title-{{ banner.id }}" name="title" class="input-base" value="{{ banner.title }}" required>
                  </div>
                  <div class="form-group">
                    <label for="image-{{ banner.id }}">URL immagine</label>
                    <input type="url" id="image-{{ banner.id }}" name="image_url" class="input-base" value="{{ banner.image_url }}" required>
                  </div>
                  <div class="form-group">
                    <label for="target-{{ banner.id }}">Link destinazione</label>
                    <input type="url" id="target-{{ banner.id }}" name="target_url" class="input-base" value="{{ banner.target_url }}" required>
                  </div>
                </div>
                <div class="form-group">
                  <label for="description-{{ banner.id }}">Descrizione</label>
                  <textarea id="description-{{ banner.id }}" name="description" class="input-base" rows="2">{{ banner.description or '' }}</textarea>
                </div>
                <label class="checkbox-inline">
                  <input type="checkbox" name="active" value="1" {% if banner.active %}checked{% endif %}> Attivo
                </label>
                <div class="banner-actions">
                  <button type="submit" class="btn btn-secondary glass btn-sm"><i class="fas fa-save"></i> Salva</button>
                </div>
              </form>
              <div class="banner-meta">
                <span class="badge {{ 'premium' if banner.active else 'free' }}">{{ 'Visibile' if banner.active else 'Nascosto' }}</span>
                <small>Ultimo aggiornamento: {{ banner.updated_at.strftime('%d/%m/%Y %H:%M') if banner.updated_at else 'n/d' }}</small>
              </div>
            </div>
            <div class="banner-controls">
              <form method="POST" action="{{ url_for('admin.banner_toggle', banner_id=banner.id) }}">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit" class="btn btn-secondary glass btn-sm">
                  <i class="fas fa-eye{% if not banner.active %}-slash{% endif %}"></i>
                  {{ 'Disattiva' if banner.active else 'Attiva' }}
                </button>
              </form>
              <form method="POST" action="{{ url_for('admin.banner_delete', banner_id=banner.id) }}" onsubmit="return confirm('Eliminare questo banner?');">
                <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                <button type="submit" class="btn btn-danger btn-sm"><i class="fas fa-trash"></i> Elimina</button>
              </form>
            </div>
          </article>
        {% endfor %}
      </div>
    {% else %}
      <p class="audit-list__empty">Nessun banner registrato. Aggiungine uno per iniziare.</p>
    {% endif %}
  </article>
</section>
{% endblock %}
