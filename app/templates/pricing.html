{% extends "layout.html" %}

{% block content %}
{% set is_authenticated = current_user and current_user.is_authenticated %}
<section class="page">
  <div class="container stack">
    <header class="page__header">
      <span class="eyebrow">Piani</span>
      <h1>Due esperienze, una piattaforma</h1>
      <p class="page__lede">
        Scegli se restare sul piano gratuito per monitorare il vulcano oppure sostenere l'infrastruttura con Premium.
      </p>
    </header>

    <script type="application/ld+json" nonce="{{ csp_nonce() }}">
{
  "@context": "https://schema.org",
  "@type": "Product",
  "name": "Premium Plan EtnaMonitor",
  "description": "Piano Premium per notifiche e funzioni avanzate.",
  "offers": {
    "@type": "Offer",
    "url": "https://etnamonitor.it/pricing",
    "price": "donation",
    "priceCurrency": "EUR",
    "availability": "https://schema.org/InStock"
  }
}
    </script>

    <div class="pricing-grid" id="plans">
      <article class="pricing-card">
        <span class="pill">Free</span>
        <h2>Accesso gratuito</h2>
        <p class="muted">Perfetto per esplorare il grafico e ricevere il primo alert di prova.</p>
        <p class="pricing-highlight">Prima notifica Telegram <strong>gratis</strong> non appena ti registri.</p>
        <div class="pricing-card__price">€0</div>
        <ul>
          <li>Grafico realtime e storico 7 giorni</li>
          <li>Primo alert di prova via Telegram</li>
          <li>Dashboard responsive e note tecniche</li>
        </ul>
        <div class="page__actions">
          {% if not is_authenticated %}
            <a href="{{ url_for('auth.login') }}" class="btn btn-secondary">Accedi con Google</a>
          {% elif not current_user.has_premium_access %}
            <button class="btn btn-secondary" type="button" disabled aria-disabled="true">Piano attuale</button>
          {% else %}
            <button class="btn btn-secondary" type="button" disabled aria-disabled="true">Disponibile downgrade</button>
          {% endif %}
        </div>
      </article>

      <article class="pricing-card pricing-card--highlight" id="lifetime">
        <span class="pill">Premium</span>
        <h2>Supporter</h2>
        <p class="muted">Donazione PayPal libera con minimo <strong>€9,99</strong> per attivare Premium.</p>
        <div class="pricing-card__price">€9,99<span class="pricing-card__price-note muted"> una tantum</span></div>
        <ul>
          <li>Alert illimitati via Telegram ed email</li>
          <li>Storico completo, esportazioni e API</li>
          <li>Accesso anticipato a nuove feature</li>
          <li>Supporto prioritario dal team</li>
        </ul>
        <p class="muted">Nella donazione inserisci la tua email di registrazione.</p>
        <div class="page__actions">
          {% if not is_authenticated %}
            <a href="{{ url_for('auth.login', next=url_for('billing.donate')) }}" class="btn btn-primary">Accedi e richiedi</a>
          {% else %}
            <a href="{{ url_for('billing.donate') }}" class="btn btn-primary">Richiedi attivazione</a>
          {% endif %}
        </div>
      </article>

      <article class="pricing-card">
        <span class="pill">Perché supportare</span>
        <h2>Manteniamo il servizio libero</h2>
        <p class="muted">Le donazioni finanziano server, storage storico, sviluppo AI e nuovi canali di divulgazione.</p>
        <ul>
          <li>Uptime garantito per il grafico live</li>
          <li>Espansione dataset e ricerca applicata</li>
          <li>Reportistica aperta per la community</li>
        </ul>
        <div class="page__actions">
          <a href="{{ url_for('billing.donate') }}" class="btn btn-secondary">Scopri come donare</a>
        </div>
      </article>
    </div>

    <section class="bot-cta-section" aria-label="Attiva EtnaBot">
      <div class="cta-alert">
        <h3>Attiva subito EtnaBot</h3>
        <p>La prima notifica Telegram è gratuita. Premium si attiva con donazione PayPal (min. €9,99) con email di registrazione.</p>
        <a href="{{ url_for('main.etna_bot') }}" class="btn btn-primary btn-hero">Scopri EtnaBot</a>
      </div>
    </section>

    <div class="card card--outlined">
      <h2>Come funziona Premium</h2>
      <ol class="timeline">
        <li class="timeline__item">Effettua una donazione PayPal libera con minimo <strong>€9,99</strong>.</li>
        <li class="timeline__item">Nel messaggio PayPal inserisci l'email di registrazione EtnaMonitor.</li>
        <li class="timeline__item">PayPal: <strong>salvoferro16@gmail.com</strong> · Compila il form "Ho già donato" oppure scrivici.</li>
        <li class="timeline__item">Attiveremo il piano entro 24 ore lavorative.</li>
      </ol>
      <div class="page__actions" role="group" aria-label="Donazione Premium Lifetime">
        <form action="https://www.paypal.com/donate" method="post" target="_top">
          <input type="hidden" name="hosted_button_id" value="2T6DKB7U2ZSK8" />
          <input type="image" src="https://www.paypalobjects.com/it_IT/IT/i/btn/btn_donateCC_LG.gif" border="0" name="submit" title="PayPal - The safer, easier way to pay online!" alt="Fai una donazione con il pulsante PayPal" />
          <img alt="" border="0" src="https://www.paypal.com/it_IT/i/scr/pixel.gif" width="1" height="1" />
        </form>
        <a href="{{ url_for('billing.donate') }}" class="btn btn-secondary">Ho già donato</a>
      </div>
    </div>

    <div class="cta-panel">
      <div>
        <h2>Serve assistenza?</h2>
        <p>Scrivici a <a href="mailto:salvoferro16@gmail.com">salvoferro16@gmail.com</a> oppure contatta @EtnaMonitorBot su Telegram.</p>
      </div>
      <div class="cta-panel__actions">
        <a class="btn btn-secondary" href="mailto:salvoferro16@gmail.com">Contatta il team</a>
      </div>
    </div>
  </div>
</section>
{% endblock %}
