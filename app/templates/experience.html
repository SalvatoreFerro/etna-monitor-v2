{% extends "layout.html" %}

{% block content %}
<section class="page">
  <div class="container stack">
    <header class="page__header">
      <span class="eyebrow">Etna Experience</span>
      <h1>Guide, tour e strutture selezionate</h1>
      <p class="page__lede">Scopri partner verificati e attività da vivere attorno all'Etna. La sezione sarà ampliata con suggerimenti automatici basati sul tremore.</p>
      <div class="page__actions">
        <a class="btn btn-primary" href="#partners">Esplora i partner</a>
        <button class="btn btn-ghost" type="button" disabled>Consigli dinamici in arrivo</button>
      </div>
    </header>

    <div class="card card--outlined">
      <h2>Filtra per categoria</h2>
      <div class="filter-group" role="tablist" aria-label="Filtra partner per categoria">
        {% for value, label in filter_labels %}
          {% set is_active = (not selected_category and value == 'all') or (selected_category == value) %}
          <button
            type="button"
            class="filter-chip {{ 'is-active' if is_active }}"
            data-filter="{{ value }}"
            role="tab"
            aria-selected="{{ 'true' if is_active else 'false' }}"
          >
            {{ label }}
          </button>
        {% endfor %}
      </div>
    </div>

    <div class="grid grid--columns-3" id="partners">
      {% if partners %}
        {% for partner in partners %}
          <article class="card partner-card" data-category="{{ partner.category }}">
            <header class="partner-card__header">
              <div class="partner-card__meta">
                <span class="pill">{{ partner.category_label() }}</span>
                {% if partner.verified %}
                  <span class="badge">Verified</span>
                {% endif %}
              </div>
              <h3>{{ partner.name }}</h3>
              {% if partner.contact %}
                <p class="muted">{{ partner.contact }}</p>
              {% endif %}
            </header>
            {% if partner.description %}
              <p>{{ partner.description }}</p>
            {% endif %}
            <div class="page__actions">
              {% if partner.website %}
                <a href="{{ partner.website }}" class="btn btn-secondary" target="_blank" rel="noopener">Visita il sito</a>
              {% else %}
                <button class="btn btn-ghost" type="button" disabled aria-disabled="true">Contatta la struttura</button>
              {% endif %}
            </div>
          </article>
        {% endfor %}
      {% else %}
        <div class="card">
          <h3>Nessun partner disponibile</h3>
          <p>Stiamo selezionando nuove esperienze da mostrare qui. Torna a trovarci presto!</p>
        </div>
      {% endif %}
    </div>

    <div class="cta-panel">
      <div>
        <h2>Vuoi apparire su Etna Experience?</h2>
        <p>Compila il modulo dedicato e raccontaci la tua attività.</p>
      </div>
      <div class="cta-panel__actions">
        <a class="btn btn-primary" href="{{ url_for('experience.become_partner') }}">Candidati come partner</a>
      </div>
    </div>
  </div>
</section>

<script nonce="{{ script_nonce }}">
document.addEventListener('DOMContentLoaded', () => {
  const buttons = Array.from(document.querySelectorAll('[data-filter]'));
  const cards = Array.from(document.querySelectorAll('.partner-card'));
  if (!buttons.length || !cards.length) {
    return;
  }
  const applyFilter = (category) => {
    cards.forEach((card) => {
      const matches = category === 'all' || card.dataset.category === category;
      card.classList.toggle('is-hidden', !matches);
    });
  };
  const initial = buttons.find((btn) => btn.classList.contains('is-active'));
  applyFilter(initial ? initial.dataset.filter : 'all');
  buttons.forEach((button) => {
    button.addEventListener('click', () => {
      buttons.forEach((btn) => {
        btn.classList.remove('is-active');
        btn.setAttribute('aria-selected', 'false');
      });
      button.classList.add('is-active');
      button.setAttribute('aria-selected', 'true');
      applyFilter(button.dataset.filter);
    });
  });
});
</script>
{% endblock %}
