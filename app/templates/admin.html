{% extends "layout.html" %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/theme.css') }}">
{% endblock %}

{% block content %}
<div class="admin-container">
  <div class="admin-header card-premium animate-premium-fade">
    <h1><i class="fas fa-users-cog"></i> Admin Panel</h1>
    <p>Manage users and system settings</p>
  </div>
  
  <div class="admin-content card-premium animate-premium-slide">
    <div class="table-container">
      <table class="table table-premium">
        <thead>
          <tr>
            <th>Email</th>
            <th>Account Type</th>
            <th>Custom Threshold</th>
            <th>Chat ID</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
          {% for user in users %}
            <tr>
              <td>{{ user.email }}</td>
              <td>
                <span class="badge {{ 'premium' if user.premium else 'free' }}">
                  {{ 'Premium ‚≠ê' if user.premium else 'Free' }}
                </span>
                {% if user.is_admin %}
                  <span class="badge admin">Admin</span>
                {% endif %}
              </td>
              <td>{{ user.threshold or 'Default (2.0)' }} mV</td>
              <td>{{ user.chat_id or 'Not set' }}</td>
              <td>
                <div class="action-buttons">
                  <button onclick="togglePremium({{ user.id }})" class="btn btn-premium btn-sm">
                    <i class="fas fa-{{ 'star' if not user.premium else 'star-half-alt' }}"></i>
                    {{ 'Upgrade' if not user.premium else 'Downgrade' }}
                  </button>
                  {% if not user.is_admin %}
                    <button onclick="deleteUser({{ user.id }})" class="btn btn-danger btn-sm">
                      <i class="fas fa-trash"></i> Delete
                    </button>
                  {% endif %}
                </div>
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</div>

  <script>
    function togglePremium(userId) {
      fetch(`/admin/toggle_premium/${userId}`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        }
      })
      .then(response => response.json())
      .then(data => {
        if (data.success) {
          location.reload();
        }
      });
    }

    function deleteUser(userId) {
      if (confirm('Are you sure you want to delete this user? This action cannot be undone.')) {
        fetch(`/admin/delete_user/${userId}`, {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          }
        })
        .then(response => response.json())
        .then(data => {
          if (data.success) {
            location.reload();
          } else {
            alert(data.message);
          }
        });
      }
    }
  </script>
{% endblock %}
