{% extends "layout.html" %}
{% set page_title = "Webcam Etna in diretta e meteo – EtnaMonitor" %}
{% set page_description = "Webcam live dell'Etna con meteo aggiornato, spiegazioni per leggere le immagini e dati EtnaMonitor su tremore e hotspot." %}
{% set page_og_title = page_title %}
{% set page_og_description = page_description %}
{% set canonical_url = url_for('main.webcam_etna', _external=True) %}
{% set is_authenticated = current_user and current_user.is_authenticated %}
{% set has_telegram = is_authenticated and (current_user.telegram_chat_id or current_user.chat_id) and current_user.telegram_opt_in %}
{% if not is_authenticated %}
  {% set telegram_cta_url = url_for('auth.login') %}
{% elif has_telegram %}
  {% set telegram_cta_url = url_for('dashboard.dashboard_home') %}
{% else %}
  {% set telegram_cta_url = url_for('dashboard.dashboard_home') ~ '#alert-settings' %}
{% endif %}
{% set graph_live_url = url_for('main.index') ~ '#grafico-etna' %}

{% block content %}
<section class="page page--webcam">
  <div class="container stack">
    <header class="page__header">
      <span class="eyebrow">Live</span>
      <h1>Webcam dell'Etna e meteo in tempo reale</h1>
      <p class="page__lede">
        Tre punti di osservazione privilegiati per seguire l'attività del vulcano 24/7 con un colpo d'occhio sulle condizioni
        meteo aggiornate in quota.
      </p>
    </header>

    <section class="webcam-weather" aria-labelledby="webcam-weather-title">
      <div class="webcam-weather__card">
        <div class="webcam-weather__header">
          <div>
            <h2 id="webcam-weather-title">Condizioni meteo live sull'Etna</h2>
            <p class="muted">Dati in tempo reale dall'API Open-Meteo per l'area sommitale del vulcano.</p>
          </div>
          <i class="fa-solid fa-cloud-sun"></i>
        </div>

        {% if weather_preview %}
          <div class="webcam-weather__summary">
            {% if weather_preview.weather_description %}
              <p class="webcam-weather__condition">{{ weather_preview.weather_description }}</p>
            {% endif %}
            <div class="webcam-weather__grid" role="list">
              <div class="webcam-weather__item" role="listitem">
                <span class="webcam-weather__label">Temperatura</span>
                {% if weather_preview.temperature is not none %}
                  <strong class="webcam-weather__value">{{ weather_preview.temperature | round(1) }} {{ weather_preview.temperature_unit }}</strong>
                {% else %}
                  <strong class="webcam-weather__value">—</strong>
                {% endif %}
                {% if weather_preview.apparent_temperature is not none %}
                  <span class="webcam-weather__meta">Percepita {{ weather_preview.apparent_temperature | round(1) }} {{ weather_preview.apparent_temperature_unit }}</span>
                {% endif %}
              </div>
              <div class="webcam-weather__item" role="listitem">
                <span class="webcam-weather__label">Umidità</span>
                {% if weather_preview.humidity is not none %}
                  <strong class="webcam-weather__value">{{ weather_preview.humidity | round(0) }}{{ weather_preview.humidity_unit }}</strong>
                {% else %}
                  <strong class="webcam-weather__value">—</strong>
                {% endif %}
              </div>
              <div class="webcam-weather__item" role="listitem">
                <span class="webcam-weather__label">Vento</span>
                {% if weather_preview.wind_speed is not none %}
                  <strong class="webcam-weather__value">{{ weather_preview.wind_speed | round(1) }} {{ weather_preview.wind_speed_unit }}</strong>
                {% else %}
                  <strong class="webcam-weather__value">—</strong>
                {% endif %}
                {% if weather_preview.wind_direction_cardinal %}
                  <span class="webcam-weather__meta">Direzione {{ weather_preview.wind_direction_cardinal }}</span>
                {% endif %}
              </div>
              <div class="webcam-weather__item" role="listitem">
                <span class="webcam-weather__label">Probabilità precipitazioni</span>
                {% if weather_preview.precipitation_probability is not none %}
                  <strong class="webcam-weather__value">{{ weather_preview.precipitation_probability | round(0) }}{{ weather_preview.precipitation_unit }}</strong>
                {% else %}
                  <strong class="webcam-weather__value">—</strong>
                {% endif %}
              </div>
            </div>
            {% if weather_preview.updated_at %}
              <p class="webcam-weather__timestamp">Aggiornato alle {{ weather_preview.updated_at }} (ora locale).</p>
            {% endif %}
          </div>
        {% elif weather_error %}
          <p class="webcam-weather__error">{{ weather_error }}</p>
        {% else %}
          <p class="webcam-weather__loading">Caricamento delle condizioni meteo…</p>
        {% endif %}
      </div>
    </section>

    <section class="webcam-notes" aria-label="Avvisi Telegram e grafico live">
      <div class="webcam-notes__content">
        <h2>Segui l’Etna con avvisi puntuali</h2>
        <p>
          Il meteo aiuta a valutare visibilità e condizioni in quota; l’attività del vulcano si segue dal grafico del tremore.
        </p>
        <div class="hero__actions">
          <a
            class="btn btn-primary"
            href="{{ telegram_cta_url }}"
            data-cta="telegram_primary"
            data-location="webcam"
          >Ricevi avvisi su Telegram</a>
          <a
            class="btn btn-secondary"
            href="{{ graph_live_url }}"
            data-cta="graph_live_secondary"
            data-location="webcam"
          >Apri il grafico live</a>
        </div>
        <p class="muted">Gratis con un account EtnaMonitor.</p>
      </div>
    </section>

    <section class="webcam-grid" aria-label="Elenco webcam live dell'Etna">
      {% for camera in webcams %}
        <article class="webcam-card">
          <a class="webcam-card__link" href="{{ camera.url }}" target="_blank" rel="noopener" aria-label="Apri {{ camera.name }} in una nuova scheda">
            <figure class="webcam-card__media">
              <img src="{{ camera.thumbnail }}" alt="Anteprima live di {{ camera.name }}" loading="lazy" width="640" height="360" />
              <figcaption class="webcam-card__overlay">
                <span class="webcam-card__cta">Guarda la webcam</span>
                <i class="fa-solid fa-arrow-up-right-from-square" aria-hidden="true"></i>
              </figcaption>
            </figure>
            <div class="webcam-card__body">
              <h3>{{ camera.name }}</h3>
              <p>{{ camera.description }}</p>
            </div>
          </a>
        </article>
      {% endfor %}
    </section>

    <section class="webcam-insights" aria-labelledby="webcam-insights-title">
      <div class="webcam-insights__card">
        <div class="webcam-insights__text">
          <h2 id="webcam-insights-title">Immagini e dati: due livelli di lettura</h2>
          <p>
            Le webcam mostrano immagini live e possono essere influenzate da meteo, nuvole e luce. Sono perfette per vedere
            cosa accade in superficie, ma non raccontano sempre l'attività interna del vulcano.
          </p>
          <p>
            EtnaMonitor integra dati reali come tremore, hotspot e segnali sismici per capire se la situazione cambia davvero.
            Per un quadro completo consulta la pagina <a class="link-arrow" href="{{ url_for('main.eruzione_oggi') }}">Eruzione Etna oggi</a>.
          </p>
        </div>
        <div class="webcam-insights__cta">
          <p class="webcam-insights__cta-text">Vuoi sapere se qualcosa cambia davvero? Ricevi un avviso su Telegram quando serve.</p>
          <a class="btn btn-secondary" href="https://t.me/etna_turi_bot" target="_blank" rel="noopener">Ricevi avvisi su Telegram</a>
          <a class="link-arrow" href="{{ url_for('community.community_landing') }}">Scopri la community EtnaMonitor</a>
        </div>
      </div>
    </section>

    <section class="webcam-faq" aria-labelledby="webcam-faq-title">
      <h2 id="webcam-faq-title">Mini FAQ sulle webcam dell'Etna</h2>
      <div class="webcam-faq__grid">
        <article>
          <h3>Le webcam mostrano sempre un’eruzione?</h3>
          <p>
            No. Le webcam mostrano ciò che è visibile in quel momento: una fase eruttiva può essere nascosta da nuvole o luce
            sfavorevole. Per conferme affidabili servono i dati INGV.
          </p>
        </article>
        <article>
          <h3>Le webcam bastano per capire l’attività dell’Etna?</h3>
          <p>
            Sono utili, ma non sufficienti. Il tremore e i segnali sismici raccontano cosa accade all’interno del vulcano e
            spesso anticipano ciò che si vede in superficie.
          </p>
        </article>
        <article>
          <h3>Perché i dati sono più affidabili delle immagini?</h3>
          <p>
            I dati provengono da sensori scientifici continui e non dipendono dalla visibilità. Le immagini aiutano a
            interpretare, ma i numeri spiegano se l’attività sta davvero aumentando.
          </p>
        </article>
        <article>
          <h3>Quando conviene controllare anche il grafico del tremore?</h3>
          <p>
            Quando noti bagliori o fumi insoliti, oppure se vuoi capire se un cambiamento è reale. Il grafico è il modo
            più chiaro per leggere l’andamento delle ultime ore.
          </p>
        </article>
      </div>
      <p class="webcam-faq__note">
        Approfondisci su <a class="link-arrow" href="{{ url_for('main.index') }}#grafico-etna">grafico tremore</a> e nella
        <a class="link-arrow" href="{{ url_for('community.community_landing') }}">community EtnaMonitor</a>.
      </p>
    </section>

    <aside class="webcam-notes" aria-label="Suggerimenti di utilizzo">
      <div class="webcam-notes__content">
        <h2>Consigli per leggere le immagini live</h2>
        <ul>
          <li>Durante la notte le camere potrebbero essere regolate su esposizione lunga: controlla anche il meteo per interpretare correttamente i bagliori.</li>
          <li>In caso di manutenzione le webcam potrebbero risultare temporaneamente offline: aggiorna la pagina o apri il link diretto.</li>
          <li>Per analisi storiche consulta la sezione <a class="link-arrow" href="{{ url_for('main.index') }}#grafico-etna">grafico tremore</a> con gli ultimi dati INGV.</li>
        </ul>
      </div>
    </aside>
  </div>
</section>
{% endblock %}
