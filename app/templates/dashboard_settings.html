{% extends "layout.html" %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard_settings.css') }}?v={{ STATIC_ASSET_VERSION }}">
{% endblock %}

{% block content %}
<div class="settings-container">
  <div class="settings-header animate-premium-fade">
    <span class="pill">Area personale</span>
    <h1>Impostazioni account</h1>
    <p>Gestisci i dettagli del tuo profilo e scopri le funzionalitÃ  disponibili per il tuo piano.</p>
  </div>

  <div class="settings-grid">
    <section class="settings-card animate-premium-slide">
      <header>
        <h2>Riepilogo account</h2>
        <p class="muted-text">Informazioni principali sul tuo profilo e sullo stato Premium.</p>
      </header>
      <div class="account-details">
        <div class="pill">
          {% if user.has_premium_access %}
            ðŸŸ¢ Piano Premium attivo
          {% elif not user.free_alert_consumed %}
            âšª Piano Free â€“ alert di prova disponibile
          {% else %}
            ðŸ”´ Piano Free â€“ prova consumata
          {% endif %}
        </div>
        <dl>
          <dt>Email</dt>
          <dd>{{ user.email }}</dd>
          {% if user.name %}
          <dt>Nome</dt>
          <dd>{{ user.name }}</dd>
          {% endif %}
          {% if user.created_at %}
          <dt>Registrato il</dt>
          <dd>{{ user.created_at.strftime('%d/%m/%Y') }}</dd>
          {% endif %}
          <dt>Soglia attuale</dt>
          <dd>
            {% if user.has_premium_access %}
              {{ '%.1f'|format(user.threshold or default_threshold) }} mV Â· gestisci dalla
              <a class="inline-link" href="{{ url_for('dashboard.dashboard_home') }}#threshold-settings">dashboard</a>
            {% else %}
              {{ default_threshold }} mV predefiniti (aggiornabili con Premium)
            {% endif %}
          </dd>
          <dt>Stato prova gratuita</dt>
          <dd>{{ 'Disponibile' if not user.free_alert_consumed else 'Consumata' }}</dd>
          <dt>Notifiche Telegram</dt>
          <dd>
            {% if user.telegram_chat_id or user.chat_id %}
              Connesso (ID {{ user.telegram_chat_id or user.chat_id }})
              {% if user.free_alert_consumed and not user.has_premium_access %}
                Â· Premium si attiva con donazione PayPal min â‚¬9,99 (inserisci email di registrazione).
              {% endif %}
            {% else %}
              Non collegato Â· collega Telegram dalla <a class="inline-link" href="{{ url_for('dashboard.dashboard_home') }}#alert-settings">dashboard</a>
            {% endif %}
          </dd>
          {% if user.consent_ts %}
          <dt>Consenso Telegram</dt>
          <dd>{{ user.consent_ts.strftime('%d/%m/%Y %H:%M') }} Â· Privacy {{ user.privacy_version or 'corrente' }}</dd>
          {% endif %}
        </dl>
      </div>

      <div class="actions-group">
        <a href="{{ url_for('dashboard.dashboard_home') }}" class="btn btn-secondary glass">Apri Dashboard</a>
        <a href="{{ url_for('dashboard.dashboard_home') }}#threshold-settings" class="btn btn-premium">Gestisci soglia</a>
        <a href="{{ url_for('dashboard.dashboard_home') }}#alert-settings" class="btn btn-secondary glass">Configura avvisi</a>
      </div>
    </section>

    <section class="settings-card secondary-card animate-premium-slide">
      <header>
        <h2>{% if user.has_premium_access %}Strumenti avanzati Premium{% else %}PerchÃ© attivare Premium{% endif %}</h2>
        <p class="muted-text">
          {% if user.has_premium_access %}
            Sfrutta tutte le funzionalitÃ  dedicate al monitoraggio pro avanzato.
          {% else %}
            Sblocca strumenti esclusivi per un monitoraggio completo e in tempo reale.
          {% endif %}
        </p>
      </header>
      <ul class="feature-list">
        <li>
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 10.5L7.5 14L16 6" stroke="#4ade80" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <div>
            <h3>Soglie personalizzate</h3>
            <p class="muted-text">Imposta il livello di allerta direttamente dalla dashboard per adattare gli avvisi al tuo scenario.</p>
          </div>
        </li>
        <li>
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 10.5L7.5 14L16 6" stroke="#4ade80" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <div>
            <h3>Avvisi in tempo reale</h3>
            <p class="muted-text">Ricevi notifiche email e Telegram sugli eventi critici senza ritardi.</p>
          </div>
        </li>
        <li>
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 10.5L7.5 14L16 6" stroke="#4ade80" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <div>
            <h3>Storico eventi</h3>
            <p class="muted-text">Consulta le variazioni recenti registrate dalla piattaforma per un'analisi rapida.</p>
          </div>
        </li>
      </ul>

      {% if not user.has_premium_access %}
      <a href="{{ url_for('billing.donate') }}" class="btn btn-premium">Attiva Premium (PayPal)</a>
      <p class="muted-text">Donazione PayPal (min. â‚¬9,99) Â· Inserisci l'email di registrazione.</p>
      {% else %}
      <p class="muted-text">Hai giÃ  accesso a tutte le funzionalitÃ  Premium: personalizzale dalla dashboard in qualsiasi momento.</p>
      {% endif %}
    </section>

    <section class="settings-card secondary-card animate-premium-slide">
      <header>
        <h2>Privacy &amp; dati personali</h2>
        <p class="muted-text">Scarica una copia delle tue informazioni o avvia la procedura di eliminazione account in autonomia.</p>
      </header>
      <ul class="feature-list">
        <li>
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 10.5L7.5 14L16 6" stroke="#4ade80" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <div>
            <h3>Export dati</h3>
            <p class="muted-text">Ricevi un file JSON con post, impostazioni e storico moderazione associati al tuo profilo.</p>
          </div>
        </li>
        <li>
          <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M4 10.5L7.5 14L16 6" stroke="#4ade80" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
          </svg>
          <div>
            <h3>Eliminazione self-service</h3>
            <p class="muted-text">Annulla gli avvisi, anonimizza i dati e pianifica il purge automatico entro i tempi GDPR (30 giorni).</p>
          </div>
        </li>
      </ul>
      <div class="actions-group">
        <a href="{{ url_for('account.export_data') }}" class="btn btn-secondary glass">Esporta dati (JSON)</a>
        <form method="post" action="{{ url_for('account.delete_request') }}" onsubmit="return confirm('Confermi di voler ricevere il link per eliminare il tuo account?');">
          <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
          <button type="submit" class="btn btn-danger">Richiedi eliminazione</button>
        </form>
      </div>
    </section>
  </div>

  <section class="settings-card animate-premium-fade">
    <header>
      <h2>Supporto e risorse</h2>
      <p class="muted-text">Consigli pratici per sfruttare al meglio Etna Monitor.</p>
    </header>
    <ul class="feature-list">
      <li>
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M4 10.5L7.5 14L16 6" stroke="#4ade80" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <div>
          <h3>Dashboard live</h3>
          <p class="muted-text">Monitora il tremore in tempo reale e aggiorna il grafico con l'intervallo che preferisci.</p>
        </div>
      </li>
      <li>
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M4 10.5L7.5 14L16 6" stroke="#4ade80" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <div>
          <h3>Preferenze alert</h3>
          <p class="muted-text">Attiva gli avvisi piÃ¹ importanti per te direttamente dalla dashboard.</p>
        </div>
      </li>
      <li>
        <svg width="20" height="20" viewBox="0 0 20 20" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M4 10.5L7.5 14L16 6" stroke="#4ade80" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
        </svg>
        <div>
          <h3>Supporto dedicato</h3>
          <p class="muted-text">Hai bisogno di aiuto? Scrivici a <a class="inline-link" href="mailto:salvoferro16@gmail.com">salvoferro16@gmail.com</a>.</p>
        </div>
      </li>
    </ul>
  </section>
</div>
{% endblock %}
