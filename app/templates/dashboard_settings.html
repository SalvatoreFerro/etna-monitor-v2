{% extends "layout.html" %}

{% block head %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/theme.css') }}">
<style>
@media only screen and (max-width: 393px) and (-webkit-min-device-pixel-ratio: 3) {
  .settings-container {
    padding: 12px max(4px, env(safe-area-inset-right)) 12px max(4px, env(safe-area-inset-left));
    width: 100%;
    box-sizing: border-box;
  }
  
  .settings-header {
    padding: 16px max(4px, env(safe-area-inset-right)) 16px max(4px, env(safe-area-inset-left));
    margin-bottom: 12px;
    width: 100%;
    box-sizing: border-box;
  }
  
  .settings-header h1 {
    font-size: var(--font-size-xl);
    margin-bottom: var(--space-2);
  }
  
  .settings-content {
    padding: 16px max(4px, env(safe-area-inset-right)) 16px max(4px, env(safe-area-inset-left));
    width: 100%;
    box-sizing: border-box;
  }
  
  .settings-form {
    width: 100%;
    box-sizing: border-box;
  }
  
  .form-group {
    margin-bottom: var(--space-4);
    width: 100%;
    box-sizing: border-box;
  }
  
  .input-base {
    width: 100%;
    box-sizing: border-box;
    font-size: var(--font-size-sm);
  }
  
  .btn {
    width: 100%;
    justify-content: center;
    margin-bottom: var(--space-3);
  }
  
  .navigation-actions {
    width: 100%;
    box-sizing: border-box;
  }
  
  .upgrade-prompt {
    text-align: center;
    padding: var(--space-4);
    width: 100%;
    box-sizing: border-box;
  }
}
</style>
{% endblock %}

{% block content %}
<div class="settings-container">
  <div class="settings-header card-premium animate-premium-fade">
    <h1>Impostazioni Dashboard</h1>
    <p>Personalizza le tue preferenze di monitoraggio</p>
  </div>
  
  <div class="settings-content card-premium animate-premium-slide">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }}">{{ message }}</div>
        {% endfor %}
      {% endif %}
    {% endwith %}
    
    {% if user.premium %}
      <form method="POST" class="settings-form">
        <div class="form-group">
          <label for="threshold">Soglia Personalizzata Alert (mV):</label>
          <input type="number" id="threshold" name="threshold" class="input-base"
                 value="{{ user.threshold or default_threshold }}" 
                 step="0.1" min="0.1" max="100.0" required>
          <small>Range: 0.1 - 100.0 mV</small>
        </div>
        <button type="submit" class="btn btn-premium">Aggiorna Soglia</button>
      </form>
    {% else %}
      <div class="upgrade-prompt">
        <p>Account Premium richiesto per soglie personalizzate.</p>
        <p>Soglia predefinita attuale: <strong>{{ default_threshold }} mV</strong></p>
        <a href="/pricing" class="btn btn-premium">Passa a Premium</a>
      </div>
    {% endif %}
    
    <div class="navigation-actions">
      <a href="{{ url_for('dashboard.dashboard_home') }}" class="btn btn-secondary glass">Torna alla Dashboard</a>
    </div>
  </div>
</div>
{% endblock %}
